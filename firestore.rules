rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() {
      return request.auth != null;
    }

    match /organizations/{orgId} {
      // licologPosts: 作成は認証 + pending + orgId一致
      match /licologPosts/{postId} {
        allow create: if signedIn()
          && request.resource.data.status == 'pending'
          && request.resource.data.orgId == orgId;
        allow read: if signedIn();              // 社内ウォール想定
        allow update, delete: if false;         // 承認UI実装後に開ける
      }

      // jobs: とりあえず作成だけ認証 + orgId一致で許可（MVP）
      match /jobs/{jobId} {
        allow create: if signedIn()
          && request.resource.data.orgId == orgId;
        allow read: if signedIn();
        allow update, delete: if false;
      }
    }
  }
}