rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    function signedIn() { return request.auth != null; }

    // 公開スナップショット（求人の JSON など）は誰でも読める
    match /public/{path=**} {
      allow read: if true;
      allow write: if false;
    }

    // リコログの画像：ログインしている人だけ閲覧可
    // 書き込み（新規/上書き/削除）は本人のみ
    match /orgs/{orgId}/users/{uid}/posts/{postId}/{fileName} {
      allow read:  if signedIn();
      allow write: if signedIn() && request.auth.uid == uid;
    }
  }
}